<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <title>Preavaluació</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- MSAL -->
  <link rel="preconnect" href="https://alcdn.msauth.net">
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>

  <!-- Configuració (ara dins /js) -->
  <script src="js/config-preavaluacio.js"></script>

  <!-- Estils base (ara dins /css) -->
  <link rel="stylesheet" href="css/base.css" />
</head>
<body>

  <!-- Portada (sense barra de progrés) -->
  <section class="hero" id="hero">
    <div class="container">
      <div>
        <h1>Preavaluació<br><span style="opacity:.92;font-weight:600;">1r de SMX / DAM</span></h1>
        <p>Inicia sessió per accedir a la preavaluació. Et mostrarem només els teus mòduls i alumnes.</p>
        <button id="btnStart" class="cta">Inicia ara</button>
        <p class="muted"><small>Cal compte del centre (Microsoft 365).</small></p>
      </div>
    </div>
  </section>

  <!-- Barra superior amb nom del professor + Tanca sessió (només post-login) -->
  <div class="appbar hidden" id="appbar">
    <div class="appbar-inner">
      <span class="who" id="whoami">—</span>
      <button class="logout" id="btnLogout" title="Tanca sessió">Tanca sessió</button>
    </div>
  </div>

  <!-- Aplicació principal (mòduls → alumnes → formulari) -->
  <div class="wrap hidden" id="app">
    <div class="card">

      <!-- Vista 1: Mòduls del professor -->
      <section id="view-modules">
        <h2 style="margin:14px 0 6px">Mòduls assignats</h2>
        <p class="muted" id="modulesIntro">
          Selecciona un mòdul per veure els alumnes i l'estat de la preavaluació.
        </p>
        <table aria-describedby="modulesIntro">
          <thead>
            <tr>
              <th>Mòdul</th>
              <th>Codi</th>
              <th>Alumnes preavaluats</th>
              <th>Accions</th>
            </tr>
          </thead>
          <tbody id="modulesTableBody"></tbody>
        </table>
        <p class="muted" id="noModules" style="display:none;margin-top:10px;">
          No s'ha trobat cap mòdul assignat per a aquest professor.
        </p>
      </section>

      <!-- Vista 2: Alumnes d'un mòdul -->
      <section id="view-students" class="hidden">
        <button type="button" class="btn btn-small" id="btnBackToModules">← Torna als mòduls</button>
        <h2 id="studentsModuleTitle" style="margin:14px 0 6px">Alumnes del mòdul</h2>
        <p class="muted" id="studentsModuleSummary"></p>

        <div class="row" style="margin-top:10px;align-items:flex-end;">
          <div>
            <label for="filterStatus">Filtre</label>
            <select id="filterStatus">
              <option value="all">Tots els alumnes</option>
              <option value="pending">Només pendents</option>
              <option value="done">Només amb preavaluació</option>
            </select>
          </div>
        </div>

        <table aria-describedby="studentsModuleSummary">
          <thead>
            <tr>
              <th>Alumne</th>
              <th>Curs / Grup</th>
              <th>Estat</th>
              <th>Accions</th>
            </tr>
          </thead>
          <tbody id="studentsTableBody"></tbody>
        </table>

        <p class="muted" id="noStudents" style="display:none;margin-top:10px;">
          No hi ha alumnes per a aquest mòdul.
        </p>
      </section>

      <!-- Vista 3: Formulari de preavaluació -->
      <section id="view-form" class="hidden">
        <button type="button" class="btn btn-small" id="btnBackToStudents">← Torna als alumnes</button>

        <h2 id="formTitle" style="margin:14px 0 6px">Preavaluació</h2>
        <p class="muted" id="formSubtitle"></p>

        <fieldset>
          <legend>Resum de la situació</legend>
          <label for="preComment">Comentaris sobre l'alumne</label>
          <textarea id="preComment" rows="4" placeholder="Comentaris sobre assistència, actitud, treball, etc."></textarea>
        </fieldset>

        <fieldset>
          <legend>Valoracions</legend>

          <div class="row">
            <div>
              <label for="preGrade">Nota estimada (0–10)</label>
              <input id="preGrade" type="number" min="0" max="10" step="0.1" />
            </div>
            <div>
              <label for="preTrafficLight">Semàfor</label>
              <select id="preTrafficLight">
                <option value="">— Selecciona una opció —</option>
                <option value="Verd">Verd</option>
                <option value="Groc">Groc</option>
                <option value="Vermell">Vermell</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="preAcademic">Acadèmic (1–4)</label>
              <select id="preAcademic">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </div>
            <div>
              <label for="preBehavior">Comportament (1–4)</label>
              <select id="preBehavior">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="preInteractions">Interaccions (1–4)</label>
              <select id="preInteractions">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </div>
            <div>
              <label for="preMotivation">Motivació (1–4)</label>
              <select id="preMotivation">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </div>
          </div>

          <label for="preNeeds">Necessitats/Adaptacions (separa amb ; )</label>
          <input id="preNeeds" type="text" />

          <label for="preCommentExtra">Comentari (3–5 línies)</label>
          <textarea id="preCommentExtra" rows="3"></textarea>
        </fieldset>

        <fieldset>
          <legend>Recomanació</legend>
          <label for="preRecommendation">Recomanació per al tutor</label>
          <select id="preRecommendation">
            <option value="">— Selecciona una opció —</option>
            <option value="positiva">Evolució positiva, continuar igual</option>
            <option value="millorable">Cal millorar alguns aspectes</option>
            <option value="seguiment">Requereix seguiment proper</option>
          </select>
        </fieldset>

        <div style="display:flex;gap:10px;margin-top:10px;align-items:center;">
          <button type="button" class="btn" id="btnSaveForm">Desa la preavaluació</button>
          <span id="saveStatus" class="muted"></span>
        </div>
      </section>

      <!-- Missatges generals -->
      <p id="status" class="muted" style="margin-top:12px;"></p>
    </div>
  </div>

  <!-- Lògica de l'aplicació (separada en un JS propi) -->
  <script src="js/app-preavaluacio.js"></script>
</body>
</html>
